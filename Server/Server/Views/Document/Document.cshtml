@model Server.ViewModels.IdentifierViewModel
<div id='busyIndicator'>@Html.Partial("~/Views/Shared/Spinner.cshtml")</div>
<div id='scaffolding'>
	<table class="title"><tr>
	    <td><h1 id='title'>…</h1></td>
	    <td><a asp-action="Edit">Edit</a></td>
	    <td><a asp-action="GetHistory">History</a></td>
	</tr>
	    <tr><td colspan="3">
	    Saved by <span id='authorDisplayName'></span> on <span id='timestamp'>…</span>
	    </td></tr>
	</table>
	<hr />
	<div id='documentBody' />
</div>
@section Scripts {
<script src='https://cdnjs.cloudflare.com/ajax/libs/marked/0.3.17/marked.min.js'></script>
<script>
$("#scaffolding").hide();
var partsToLoad = 3;
function advanceLoading() {
	partsToLoad--;
	if(partsToLoad <= 0) {
		$('#busyIndicator').remove();
		$("#scaffolding").show();
	}
}
function escapeHtml(text) {
	var map = {
		'&': '&amp;',
		'<': '&lt;',
		'>': '&gt;',
		'"': '&quot;',
		"'": '&#039;'
	};
	return text.replace(/[&<>"']/g, function(m) { return map[m]; });
}
function consumeDocumentBody(data) {
	$('#documentBody').html(marked(escapeHtml(data)));
	advanceLoading();
}
function consumeAuthorMetadata(data) {
	$('#authorDisplayName').html(escapeHtml(data.displayName));
	advanceLoading();
}
function consumeDocumentMetadata(data) {
	$('#title').html(marked(escapeHtml(data.title)));
	$('#timestamp').html(escapeHtml(data.timestamp));
	$.getJSON('/api/accounts/' + data.authorId + '/metadata', consumeAuthorMetadata);
	advanceLoading();
}
$.get('/api/documents/@(Model.Id)', consumeDocumentBody);
$.getJSON('/api/documents/@(Model.Id)/metadata', consumeDocumentMetadata);
</script>
}